
<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="PhyloNetworks is a Julia package for the manipulation, visualization and inference of phylogenetic networks.">
      
      
      
        <meta name="author" content="Claudia Sol&iacute;s-Lemus">
      
      
        <link rel="shortcut icon" href="../../assets/images/favicon.png">
      
      <meta name="generator" content="mkdocs-0.16.3, mkdocs-material-1.7.4">
    
    
      
        <title>Continuous Trait Evolution - PhyloNetworks.jl</title>
      
    
    
      <script src="../../assets/javascripts/modernizr-1df76c4e58.js"></script>
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application-769c285a91.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-02c2a4388f.palette.css">
      
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../../assets/Documenter.css">
    
    
  </head>
  
  
  
  
    <body data-md-color-primary="teal" data-md-color-accent="teal">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <a href="../.." title="PhyloNetworks.jl" class="md-logo md-header-nav__button">
            <img src="../../snaq_small.png" width="24" height="24">
          </a>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
                <span class="md-header-nav__parent">
                  Manual
                </span>
              
            
            Continuous Trait Evolution
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" accesskey="s" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">close</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result" data-md-lang-search="">
          <div class="md-search-result__meta" data-md-lang-result-none="No matching documents" data-md-lang-result-one="1 matching document" data-md-lang-result-other="# matching documents">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/crsl4/PhyloNetworks.jl" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    
      <i class="md-logo md-nav__button">
        <img src="../../snaq_small.png">
      </i>
    
    PhyloNetworks.jl
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/crsl4/PhyloNetworks.jl" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Manual
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Manual
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../installation/" title="Installation" class="md-nav__link">
      Installation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../inputdata/" title="Input Data for SNaQ" class="md-nav__link">
      Input Data for SNaQ
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ticr_howtogetQuartetCFs/" title="TICR pipeline" class="md-nav__link">
      TICR pipeline
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../snaq_plot/" title="Network estimation and display" class="md-nav__link">
      Network estimation and display
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dist_reroot/" title="Network comparison and manipulation" class="md-nav__link">
      Network comparison and manipulation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../fixednetworkoptim/" title="Candidate Networks" class="md-nav__link">
      Candidate Networks
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../expectedCFs/" title="Extract Expected CFs" class="md-nav__link">
      Extract Expected CFs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../bootstrap/" title="Bootstrap" class="md-nav__link">
      Bootstrap
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../multiplealleles/" title="Multiple Alleles" class="md-nav__link">
      Multiple Alleles
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Continuous Trait Evolution
      </label>
    
    <a href="./" title="Continuous Trait Evolution" class="md-nav__link md-nav__link--active">
      Continuous Trait Evolution
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#trait-simulation" title="Trait simulation" class="md-nav__link">
    Trait simulation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#phylogenetic-regression" title="Phylogenetic regression" class="md-nav__link">
    Phylogenetic regression
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ancestral-state-reconstruction" title="Ancestral State Reconstruction" class="md-nav__link">
    Ancestral State Reconstruction
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#from-known-parameters" title="From known parameters" class="md-nav__link">
    From known parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#from-estimated-parameters" title="From estimated parameters" class="md-nav__link">
    From estimated parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-imputation" title="Data imputation" class="md-nav__link">
    Data imputation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#with-known-predictors" title="With known predictors" class="md-nav__link">
    With known predictors
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#phylogenetic-anova" title="Phylogenetic ANOVA" class="md-nav__link">
    Phylogenetic ANOVA
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pagels-lambda" title="Pagel's Lambda" class="md-nav__link">
    Pagel's Lambda
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Library
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Library
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../lib/public/" title="Public" class="md-nav__link">
      Public
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lib/internals/" title="Internals" class="md-nav__link">
      Internals
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#trait-simulation" title="Trait simulation" class="md-nav__link">
    Trait simulation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#phylogenetic-regression" title="Phylogenetic regression" class="md-nav__link">
    Phylogenetic regression
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ancestral-state-reconstruction" title="Ancestral State Reconstruction" class="md-nav__link">
    Ancestral State Reconstruction
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#from-known-parameters" title="From known parameters" class="md-nav__link">
    From known parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#from-estimated-parameters" title="From estimated parameters" class="md-nav__link">
    From estimated parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-imputation" title="Data imputation" class="md-nav__link">
    Data imputation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#with-known-predictors" title="With known predictors" class="md-nav__link">
    With known predictors
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#phylogenetic-anova" title="Phylogenetic ANOVA" class="md-nav__link">
    Phylogenetic ANOVA
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pagels-lambda" title="Pagel's Lambda" class="md-nav__link">
    Pagel's Lambda
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/crsl4/PhyloNetworks.jl/edit/master/docs/man/trait_tree.md" title="Edit this page" class="md-icon md-content__icon">edit</a>
                
                
                <p><a id='Continuous-Trait-Evolution-1'></a></p>
<h1 id="continuous-trait-evolution">Continuous Trait Evolution</h1>
<p>Once the network is inferred, we can take these species relationships into account when studying the distribution of quantitative traits measured for extant species. This is the goal of phylogenetic comparative methods (PCM).</p>
<p>We assume a fixed network, correctly rooted, with branch lengths proportional to calendar time. Here, we consider the true network that was used in the previous sections, and which is ultrametric (all the tips are contemporary).</p>
<div class="codehilite"><pre><span></span><span class="n">truenet</span> <span class="o">=</span> <span class="n">readTopology</span><span class="p">(</span><span class="s">&quot;((((D:0.4,C:0.4):4.8,((A:0.8,B:0.8):2.2)#H1:2.2::0.7):4.0,(#H1:0::0.3,E:3.0):6.2):2.0,O:11.2);&quot;</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">truenet</span><span class="p">,</span> <span class="n">useEdgeLength</span><span class="o">=</span><span class="kc">true</span><span class="p">,</span> <span class="n">showGamma</span><span class="o">=</span><span class="kc">true</span><span class="p">)</span>
</pre></div>


<p><img alt="" src="../../assets/figures/trait_tree_truenet_1.png" /></p>
<p><a id='Trait-simulation-1'></a></p>
<h2 id="trait-simulation">Trait simulation</h2>
<p>We start by generating continuous traits to study. We simulate three traits on the network (two independent, one dependent), using a Brownian Motion (BM) model of trait evolution on the network. We start by choosing the parameters of the BM (ancestral mean and variance), by creating objects of class <a href="../../lib/public/#PhyloNetworks.ParamsBM"><code>ParamsBM</code></a><code>&lt;:ParamsProcess</code>.</p>
<div class="codehilite"><pre><span></span><span class="n">params_trait1</span> <span class="o">=</span> <span class="n">ParamsBM</span><span class="p">(</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span> <span class="c"># BM with mean  2 and variance 0.5</span>
<span class="n">params_trait2</span> <span class="o">=</span> <span class="n">ParamsBM</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>   <span class="c"># BM with mean -2 and variance 1.0</span>
</pre></div>


<p>We then simulate the independent traits according to these parameters, using function <a href="../../lib/public/#PhyloNetworks.simulate"><code>simulate</code></a> (fixing the seed, for reproducibility).</p>
<div class="codehilite"><pre><span></span><span class="n">srand</span><span class="p">(</span><span class="mi">18480224</span><span class="p">)</span>
<span class="n">sim1</span> <span class="o">=</span> <span class="n">simulate</span><span class="p">(</span><span class="n">truenet</span><span class="p">,</span> <span class="n">params_trait1</span><span class="p">)</span> <span class="c"># simulate a BM on truenet</span>
<span class="n">sim2</span> <span class="o">=</span> <span class="n">simulate</span><span class="p">(</span><span class="n">truenet</span><span class="p">,</span> <span class="n">params_trait2</span><span class="p">)</span>
</pre></div>


<p>This creates objects of class <a href="../../lib/public/#PhyloNetworks.TraitSimulation"><code>TraitSimulation</code></a>, from which we can extract the data at the tips, thanks to the method <a href="../../lib/public/#Base.getindex-Tuple{PhyloNetworks.TraitSimulation,Symbol}"><code>getindex(::TraitSimulation, ::Symbol)</code></a>.</p>
<div class="codehilite"><pre><span></span><span class="n">trait1</span> <span class="o">=</span> <span class="n">sim1</span><span class="p">[</span><span class="o">:</span><span class="n">Tips</span><span class="p">]</span> <span class="c"># trait 1 at the tips (data)</span>
<span class="n">trait2</span> <span class="o">=</span> <span class="n">sim2</span><span class="p">[</span><span class="o">:</span><span class="n">Tips</span><span class="p">]</span>
</pre></div>


<p>This extractor creates an <code>Array</code> with one column, and as many lines as the number of tips there are in the phylogeny.  It is sorted in the same order as the tips of the phylogeny used to simulate it.   If needed, we could also extract the simulated values at the internal nodes in the tre:</p>
<div class="codehilite"><pre><span></span><span class="n">sim1</span><span class="p">[</span><span class="o">:</span><span class="n">InternalNodes</span><span class="p">]</span>
</pre></div>


<p>Finally, we generate the last trait correlated with trait 1 (but not trait 2), with phylogenetic noise.</p>
<div class="codehilite"><pre><span></span><span class="n">srand</span><span class="p">(</span><span class="mi">18700904</span><span class="p">)</span>
<span class="n">noise</span> <span class="o">=</span> <span class="n">simulate</span><span class="p">(</span><span class="n">truenet</span><span class="p">,</span> <span class="n">ParamsBM</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">))</span> <span class="c"># phylogenetic residuals</span>
<span class="n">trait3</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">trait1</span> <span class="o">+</span> <span class="n">noise</span><span class="p">[</span><span class="o">:</span><span class="n">Tips</span><span class="p">]</span> <span class="c"># trait to study. independent of trait2</span>
</pre></div>


<p><a id='Phylogenetic-regression-1'></a></p>
<h2 id="phylogenetic-regression">Phylogenetic regression</h2>
<p>Assume that we measured the three traits above, and that we wanted to study the impact of traits 1 and 2 on trait 3. To do that, we can perform a phylogenetic regression.</p>
<p>In order to avoid confusion, the function takes in a <code>DataFrame</code>, that has an extra column with the names of the tips of the network, labeled <code>tipNames</code>. Here, we generated the traits ourselves, so they are all in the same order.</p>
<div class="codehilite"><pre><span></span><span class="n">julia</span><span class="o">&gt;</span> <span class="k">using</span> <span class="n">DataFrames</span>

<span class="n">julia</span><span class="o">&gt;</span> <span class="n">dat</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">trait1</span> <span class="o">=</span> <span class="n">trait1</span><span class="p">,</span> <span class="n">trait2</span> <span class="o">=</span> <span class="n">trait2</span><span class="p">,</span> <span class="n">trait3</span> <span class="o">=</span> <span class="n">trait3</span><span class="p">,</span>
                <span class="n">tipNames</span> <span class="o">=</span> <span class="n">tipLabels</span><span class="p">(</span><span class="n">sim1</span><span class="p">))</span>
<span class="mi">6</span><span class="n">×4</span> <span class="n">DataFrames</span><span class="o">.</span><span class="n">DataFrame</span>
<span class="n">│</span> <span class="n">Row</span> <span class="n">│</span> <span class="n">trait1</span>  <span class="n">│</span> <span class="n">trait2</span>   <span class="n">│</span> <span class="n">trait3</span>  <span class="n">│</span> <span class="n">tipNames</span> <span class="n">│</span>
<span class="n">├─────┼─────────┼──────────┼─────────┼──────────┤</span>
<span class="n">│</span> <span class="mi">1</span>   <span class="n">│</span> <span class="mf">4.08298</span> <span class="n">│</span> <span class="o">-</span><span class="mf">7.34186</span> <span class="n">│</span> <span class="mf">16.673</span>  <span class="n">│</span> <span class="s">&quot;D&quot;</span>      <span class="n">│</span>
<span class="n">│</span> <span class="mi">2</span>   <span class="n">│</span> <span class="mf">3.10782</span> <span class="n">│</span> <span class="o">-</span><span class="mf">7.45085</span> <span class="n">│</span> <span class="mf">15.0831</span> <span class="n">│</span> <span class="s">&quot;C&quot;</span>      <span class="n">│</span>
<span class="n">│</span> <span class="mi">3</span>   <span class="n">│</span> <span class="mf">2.17078</span> <span class="n">│</span> <span class="o">-</span><span class="mf">3.32538</span> <span class="n">│</span> <span class="mf">14.4522</span> <span class="n">│</span> <span class="s">&quot;A&quot;</span>      <span class="n">│</span>
<span class="n">│</span> <span class="mi">4</span>   <span class="n">│</span> <span class="mf">1.87333</span> <span class="n">│</span> <span class="o">-</span><span class="mf">4.26472</span> <span class="n">│</span> <span class="mf">13.9712</span> <span class="n">│</span> <span class="s">&quot;B&quot;</span>      <span class="n">│</span>
<span class="n">│</span> <span class="mi">5</span>   <span class="n">│</span> <span class="mf">2.8445</span>  <span class="n">│</span> <span class="o">-</span><span class="mf">5.96857</span> <span class="n">│</span> <span class="mf">16.417</span>  <span class="n">│</span> <span class="s">&quot;E&quot;</span>      <span class="n">│</span>
<span class="n">│</span> <span class="mi">6</span>   <span class="n">│</span> <span class="mf">5.88204</span> <span class="n">│</span> <span class="o">-</span><span class="mf">1.99388</span> <span class="n">│</span> <span class="mf">22.0269</span> <span class="n">│</span> <span class="s">&quot;O&quot;</span>      <span class="n">│</span>
</pre></div>


<p>Phylogenetic regression / ANOVA is based on the <a href="https://github.com/JuliaStats/GLM.jl">GLM</a> package, with the network as an extra argument, using funtion <a href="../../lib/public/#PhyloNetworks.phyloNetworklm"><code>phyloNetworklm</code></a>.</p>
<div class="codehilite"><pre><span></span><span class="n">julia</span><span class="o">&gt;</span> <span class="n">fitTrait3</span> <span class="o">=</span> <span class="n">phyloNetworklm</span><span class="p">(</span><span class="nd">@formula</span><span class="p">(</span><span class="n">trait3</span> <span class="o">~</span> <span class="n">trait1</span> <span class="o">+</span> <span class="n">trait2</span><span class="p">),</span> <span class="n">dat</span><span class="p">,</span> <span class="n">truenet</span><span class="p">)</span>
<span class="n">DataFrames</span><span class="o">.</span><span class="n">DataFrameRegressionModel</span><span class="p">{</span><span class="n">PhyloNetworks</span><span class="o">.</span><span class="n">PhyloNetworkLinearModel</span><span class="p">,</span><span class="kt">Array</span><span class="p">{</span><span class="kt">Float64</span><span class="p">,</span><span class="mi">2</span><span class="p">}}</span>

<span class="n">Formula</span><span class="o">:</span> <span class="n">trait3</span> <span class="o">~</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">trait1</span> <span class="o">+</span> <span class="n">trait2</span>

<span class="n">Model</span><span class="o">:</span> <span class="n">BM</span>

<span class="n">Parameter</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="n">Estimates</span><span class="o">:</span>
<span class="n">Sigma2</span><span class="o">:</span> <span class="mf">0.034712</span>

<span class="n">Coefficients</span><span class="o">:</span>
             <span class="n">Estimate</span> <span class="n">Std</span><span class="o">.</span><span class="n">Error</span> <span class="n">t</span> <span class="n">value</span> <span class="n">Pr</span><span class="p">(</span><span class="o">&gt;|</span><span class="n">t</span><span class="o">|</span><span class="p">)</span>
<span class="p">(</span><span class="n">Intercept</span><span class="p">)</span>   <span class="mf">11.9564</span>   <span class="mf">1.15462</span> <span class="mf">10.3552</span>   <span class="mf">0.0019</span>
<span class="n">trait1</span>        <span class="mf">1.69111</span>  <span class="mf">0.183047</span> <span class="mf">9.23868</span>   <span class="mf">0.0027</span>
<span class="n">trait2</span>       <span class="mf">0.170664</span>  <span class="mf">0.155645</span>  <span class="mf">1.0965</span>   <span class="mf">0.3530</span>

<span class="n">Log</span> <span class="n">Likelihood</span><span class="o">:</span> <span class="o">-</span><span class="mf">2.9851753461</span>
<span class="n">AIC</span><span class="o">:</span> <span class="mf">13.9703506922</span>
</pre></div>


<p>From this, we can see that the intercept, the coefficient for trait 1 and the variance of the noise are correctly estimated (given that there are only 6 taxa). In addition, the Student test for the coefficient associated with trait 2 has a high p-value, which means that this coefficient is not significantly different from 0. This is consistent with the way we simulated trait 3.</p>
<p>The function returns an object of type <a href="../../lib/public/#PhyloNetworks.PhyloNetworkLinearModel"><code>PhyloNetworkLinearModel</code></a><code>&lt;:LinPredModel</code>. It is a subtype of the GLM type <code>LinPredModel</code>, which means that all base functions from Julia <a href="https://github.com/JuliaStats/StatsBase.jl">StatsBase</a> can be applied to it. See the documentation for this type for a list of all functions that can be used. Some functions allow the user to retrieve directly the estimated parameters of the BM, and are specific to this object.</p>
<p><a id='Ancestral-State-Reconstruction-1'></a></p>
<h2 id="ancestral-state-reconstruction">Ancestral State Reconstruction</h2>
<p><a id='From-known-parameters-1'></a></p>
<h3 id="from-known-parameters">From known parameters</h3>
<p>If we assume that we know the exact model of evolution that generated the traits, we can do ancestral trait reconstruction. Here, we simulated trait 1 ourselves, so we can use the true process, with the true parameters. In other words, we can reconstruct the state at the internal nodes, given the values at the tips, the known value at the root and the known BM variance.</p>
<div class="codehilite"><pre><span></span><span class="n">ancTrait1</span> <span class="o">=</span> <span class="n">ancestralStateReconstruction</span><span class="p">(</span><span class="n">truenet</span><span class="p">,</span> <span class="n">trait1</span><span class="p">,</span> <span class="n">params_trait1</span><span class="p">)</span>
</pre></div>


<p>Function <a href="../../lib/public/#PhyloNetworks.ancestralStateReconstruction"><code>ancestralStateReconstruction</code></a> creates an object with type <a href="../../lib/public/#PhyloNetworks.ReconstructedStates"><code>ReconstructedStates</code></a>. Several extractors can be applied to it:</p>
<div class="codehilite"><pre><span></span><span class="n">julia</span><span class="o">&gt;</span> <span class="n">expectations</span><span class="p">(</span><span class="n">ancTrait1</span><span class="p">)</span> <span class="c"># predictions</span>
<span class="mi">13</span><span class="n">×2</span> <span class="n">DataFrames</span><span class="o">.</span><span class="n">DataFrame</span>
<span class="n">│</span> <span class="n">Row</span> <span class="n">│</span> <span class="n">nodeNumber</span> <span class="n">│</span> <span class="n">condExpectation</span> <span class="n">│</span>
<span class="n">├─────┼────────────┼─────────────────┤</span>
<span class="n">│</span> <span class="mi">1</span>   <span class="n">│</span> <span class="o">-</span><span class="mi">5</span>         <span class="n">│</span> <span class="mf">3.55615</span>         <span class="n">│</span>
<span class="n">│</span> <span class="mi">2</span>   <span class="n">│</span> <span class="o">-</span><span class="mi">7</span>         <span class="n">│</span> <span class="mf">2.08473</span>         <span class="n">│</span>
<span class="n">│</span> <span class="mi">3</span>   <span class="n">│</span> <span class="mi">5</span>          <span class="n">│</span> <span class="mf">2.42943</span>         <span class="n">│</span>
<span class="n">│</span> <span class="mi">4</span>   <span class="n">│</span> <span class="o">-</span><span class="mi">4</span>         <span class="n">│</span> <span class="mf">2.61415</span>         <span class="n">│</span>
<span class="n">│</span> <span class="mi">5</span>   <span class="n">│</span> <span class="o">-</span><span class="mi">8</span>         <span class="n">│</span> <span class="mf">2.56143</span>         <span class="n">│</span>
<span class="n">│</span> <span class="mi">6</span>   <span class="n">│</span> <span class="o">-</span><span class="mi">3</span>         <span class="n">│</span> <span class="mf">2.26785</span>         <span class="n">│</span>
<span class="n">│</span> <span class="mi">7</span>   <span class="n">│</span> <span class="o">-</span><span class="mi">2</span>         <span class="n">│</span> <span class="mf">2.0</span>             <span class="n">│</span>
<span class="n">│</span> <span class="mi">8</span>   <span class="n">│</span> <span class="mi">1</span>          <span class="n">│</span> <span class="mf">4.08298</span>         <span class="n">│</span>
<span class="n">│</span> <span class="mi">9</span>   <span class="n">│</span> <span class="mi">2</span>          <span class="n">│</span> <span class="mf">3.10782</span>         <span class="n">│</span>
<span class="n">│</span> <span class="mi">10</span>  <span class="n">│</span> <span class="mi">3</span>          <span class="n">│</span> <span class="mf">2.17078</span>         <span class="n">│</span>
<span class="n">│</span> <span class="mi">11</span>  <span class="n">│</span> <span class="mi">4</span>          <span class="n">│</span> <span class="mf">1.87333</span>         <span class="n">│</span>
<span class="n">│</span> <span class="mi">12</span>  <span class="n">│</span> <span class="mi">6</span>          <span class="n">│</span> <span class="mf">2.8445</span>          <span class="n">│</span>
<span class="n">│</span> <span class="mi">13</span>  <span class="n">│</span> <span class="mi">7</span>          <span class="n">│</span> <span class="mf">5.88204</span>         <span class="n">│</span>

<span class="n">julia</span><span class="o">&gt;</span> <span class="n">stderr</span><span class="p">(</span><span class="n">ancTrait1</span><span class="p">)</span> <span class="c"># associated standard errors</span>
<span class="mi">7</span><span class="o">-</span><span class="n">element</span> <span class="kt">Array</span><span class="p">{</span><span class="kt">Float64</span><span class="p">,</span><span class="mi">1</span><span class="p">}</span><span class="o">:</span>
 <span class="mf">0.312339</span>
 <span class="mf">0.429933</span>
 <span class="mf">0.812157</span>
 <span class="mf">0.985996</span>
 <span class="mf">1.00992</span> 
 <span class="mf">0.807042</span>
 <span class="mf">0.0</span>     

<span class="n">julia</span><span class="o">&gt;</span> <span class="n">predint</span><span class="p">(</span><span class="n">ancTrait1</span><span class="p">)</span> <span class="c"># prediction interval (default to 95%)</span>
<span class="mi">13</span><span class="n">×2</span> <span class="kt">Array</span><span class="p">{</span><span class="kt">Float64</span><span class="p">,</span><span class="mi">2</span><span class="p">}</span><span class="o">:</span>
 <span class="mf">2.94398</span>   <span class="mf">4.16832</span>
 <span class="mf">1.24207</span>   <span class="mf">2.92738</span>
 <span class="mf">0.837628</span>  <span class="mf">4.02123</span>
 <span class="mf">0.681629</span>  <span class="mf">4.54666</span>
 <span class="mf">0.582023</span>  <span class="mf">4.54084</span>
 <span class="mf">0.686076</span>  <span class="mf">3.84962</span>
 <span class="mf">2.0</span>       <span class="mf">2.0</span>    
 <span class="mf">4.08298</span>   <span class="mf">4.08298</span>
 <span class="mf">3.10782</span>   <span class="mf">3.10782</span>
 <span class="mf">2.17078</span>   <span class="mf">2.17078</span>
 <span class="mf">1.87333</span>   <span class="mf">1.87333</span>
 <span class="mf">2.8445</span>    <span class="mf">2.8445</span> 
 <span class="mf">5.88204</span>   <span class="mf">5.88204</span>
</pre></div>


<p>We can plot the ancestral states or prediction intervals on the tree, using the <code>nodeLabel</code> argument of the <code>plot</code> function.</p>
<div class="codehilite"><pre><span></span><span class="n">ancExpe</span> <span class="o">=</span> <span class="n">expectationsPlot</span><span class="p">(</span><span class="n">ancTrait1</span><span class="p">);</span> <span class="c"># format expected ancestral states for the plot</span>
<span class="n">plot</span><span class="p">(</span><span class="n">truenet</span><span class="p">,</span> <span class="n">nodeLabel</span> <span class="o">=</span> <span class="n">ancExpe</span><span class="p">)</span>
</pre></div>


<p><img alt="" src="../../assets/figures/trait_tree_ancestral_expe_1.png" /></p>
<div class="codehilite"><pre><span></span><span class="n">ancInt</span> <span class="o">=</span> <span class="n">predintPlot</span><span class="p">(</span><span class="n">ancTrait1</span><span class="p">)</span> <span class="c"># format the prediction intervals for the plot</span>
<span class="n">plot</span><span class="p">(</span><span class="n">truenet</span><span class="p">,</span> <span class="n">nodeLabel</span> <span class="o">=</span> <span class="n">ancInt</span><span class="p">)</span>
</pre></div>


<p><img alt="" src="../../assets/figures/trait_tree_ancestral_predint_1.png" /></p>
<p>As we know the true ancestral states here, we can compare them to our estimation.</p>
<div class="codehilite"><pre><span></span><span class="n">julia</span><span class="o">&gt;</span> <span class="n">predictions</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">infPred</span><span class="o">=</span><span class="n">predint</span><span class="p">(</span><span class="n">ancTrait1</span><span class="p">)[</span><span class="mi">1</span><span class="o">:</span><span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                        <span class="n">trueValue</span><span class="o">=</span><span class="n">sim1</span><span class="p">[</span><span class="o">:</span><span class="n">InternalNodes</span><span class="p">],</span>
                        <span class="n">supPred</span><span class="o">=</span><span class="n">predint</span><span class="p">(</span><span class="n">ancTrait1</span><span class="p">)[</span><span class="mi">1</span><span class="o">:</span><span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="mi">7</span><span class="n">×3</span> <span class="n">DataFrames</span><span class="o">.</span><span class="n">DataFrame</span>
<span class="n">│</span> <span class="n">Row</span> <span class="n">│</span> <span class="n">infPred</span>  <span class="n">│</span> <span class="n">trueValue</span> <span class="n">│</span> <span class="n">supPred</span> <span class="n">│</span>
<span class="n">├─────┼──────────┼───────────┼─────────┤</span>
<span class="n">│</span> <span class="mi">1</span>   <span class="n">│</span> <span class="mf">2.94398</span>  <span class="n">│</span> <span class="mf">2.74233</span>   <span class="n">│</span> <span class="mf">4.16832</span> <span class="n">│</span>
<span class="n">│</span> <span class="mi">2</span>   <span class="n">│</span> <span class="mf">1.24207</span>  <span class="n">│</span> <span class="mf">2.24355</span>   <span class="n">│</span> <span class="mf">2.92738</span> <span class="n">│</span>
<span class="n">│</span> <span class="mi">3</span>   <span class="n">│</span> <span class="mf">0.837628</span> <span class="n">│</span> <span class="mf">1.38334</span>   <span class="n">│</span> <span class="mf">4.02123</span> <span class="n">│</span>
<span class="n">│</span> <span class="mi">4</span>   <span class="n">│</span> <span class="mf">0.681629</span> <span class="n">│</span> <span class="mf">1.50076</span>   <span class="n">│</span> <span class="mf">4.54666</span> <span class="n">│</span>
<span class="n">│</span> <span class="mi">5</span>   <span class="n">│</span> <span class="mf">0.582023</span> <span class="n">│</span> <span class="mf">2.84188</span>   <span class="n">│</span> <span class="mf">4.54084</span> <span class="n">│</span>
<span class="n">│</span> <span class="mi">6</span>   <span class="n">│</span> <span class="mf">0.686076</span> <span class="n">│</span> <span class="mf">1.76745</span>   <span class="n">│</span> <span class="mf">3.84962</span> <span class="n">│</span>
<span class="n">│</span> <span class="mi">7</span>   <span class="n">│</span> <span class="mf">2.0</span>      <span class="n">│</span> <span class="mf">2.0</span>       <span class="n">│</span> <span class="mf">2.0</span>     <span class="n">│</span>
</pre></div>


<p><a id='From-estimated-parameters-1'></a></p>
<h3 id="from-estimated-parameters">From estimated parameters</h3>
<p>In real applications though, we do not have access to the true parameters of the process that generated the data. We can estimate it using the previous function. To fit a regular BM, we just need to do a regression of trait 1 against a simple intercept:</p>
<div class="codehilite"><pre><span></span><span class="n">fitTrait1</span> <span class="o">=</span> <span class="n">phyloNetworklm</span><span class="p">(</span><span class="nd">@formula</span><span class="p">(</span><span class="n">trait1</span> <span class="o">~</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dat</span><span class="p">,</span> <span class="n">truenet</span><span class="p">)</span>
</pre></div>


<p>We can then apply the <a href="../../lib/public/#PhyloNetworks.ancestralStateReconstruction"><code>ancestralStateReconstruction</code></a> function directly to the fitted object:</p>
<div class="codehilite"><pre><span></span><span class="n">ancTrait1Approx</span> <span class="o">=</span> <span class="n">ancestralStateReconstruction</span><span class="p">(</span><span class="n">fitTrait1</span><span class="p">)</span>
</pre></div>


<p>The prediction intervals ignore the fact that we estimated the process parameters, so they are less accurate and the function throws a warning. The output is an object of the same <a href="../../lib/public/#PhyloNetworks.ReconstructedStates"><code>ReconstructedStates</code></a> type as earlier, and the same extractors can be applied to it:</p>
<div class="codehilite"><pre><span></span><span class="n">plot</span><span class="p">(</span><span class="n">truenet</span><span class="p">,</span> <span class="n">nodeLabel</span> <span class="o">=</span> <span class="n">expectationsPlot</span><span class="p">(</span><span class="n">ancTrait1Approx</span><span class="p">))</span>
</pre></div>


<p><img alt="" src="../../assets/figures/trait_tree_ancestral1_1.png" /></p>
<p>For convenience, the two steps described above (fitting against the intercept, and then do ancestral state reconstruction) can be done all at once with a single call of the function <a href="../../lib/public/#PhyloNetworks.ancestralStateReconstruction"><code>ancestralStateReconstruction</code></a> on a DataFrame with the trait to reconstruct, and the tip labels:</p>
<div class="codehilite"><pre><span></span><span class="n">datTrait1</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">trait1</span> <span class="o">=</span> <span class="n">trait1</span><span class="p">,</span> <span class="n">tipNames</span> <span class="o">=</span> <span class="n">tipLabels</span><span class="p">(</span><span class="n">sim1</span><span class="p">))</span>
<span class="n">ancTrait1Approx</span> <span class="o">=</span> <span class="n">ancestralStateReconstruction</span><span class="p">(</span><span class="n">datTrait1</span><span class="p">,</span> <span class="n">truenet</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">truenet</span><span class="p">,</span> <span class="n">nodeLabel</span> <span class="o">=</span> <span class="n">predintPlot</span><span class="p">(</span><span class="n">ancTrait1Approx</span><span class="p">))</span>
</pre></div>


<p><img alt="" src="../../assets/figures/trait_tree_ancestral2_1.png" /></p>
<p>This produces the exact same results.</p>
<p><a id='Data-imputation-1'></a></p>
<h3 id="data-imputation">Data imputation</h3>
<p>Note that there is no theoretical difference between an internal node, for which we could not measure the value of the trait, and a missing value at a tip of the network. Consequently, the previous <a href="../../lib/public/#PhyloNetworks.ancestralStateReconstruction"><code>ancestralStateReconstruction</code></a> function can be used to do data imputation. To see this, let's add some missing values in trait 1.</p>
<div class="codehilite"><pre><span></span><span class="n">datTrait1</span><span class="p">[[</span><span class="mi">2</span><span class="p">],</span> <span class="o">:</span><span class="n">trait1</span><span class="p">]</span> <span class="o">=</span> <span class="n">NA</span> <span class="c"># second row: for taxon C</span>
<span class="n">ancTrait1Approx</span> <span class="o">=</span> <span class="n">ancestralStateReconstruction</span><span class="p">(</span><span class="n">datTrait1</span><span class="p">,</span> <span class="n">truenet</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">truenet</span><span class="p">,</span> <span class="n">nodeLabel</span> <span class="o">=</span> <span class="n">predintPlot</span><span class="p">(</span><span class="n">ancTrait1Approx</span><span class="p">))</span>
</pre></div>


<p><img alt="" src="../../assets/figures/trait_tree_ancestral3_1.png" /></p>
<p>In the plotting function, a prediction interval is shown for the missing values.</p>
<p><a id='With-known-predictors-1'></a></p>
<h3 id="with-known-predictors">With known predictors</h3>
<p>At this point, it might be tempting to apply this function to trait 3 we simulated earlier as a linear combination of trait 1 and a phylogenetic noise. However, this cannot be done directly:</p>
<div class="codehilite"><pre><span></span><span class="n">ancTrait3</span> <span class="o">=</span> <span class="n">ancestralStateReconstruction</span><span class="p">(</span><span class="n">fitTrait3</span><span class="p">)</span> <span class="c"># Throws an error !</span>
</pre></div>


<p>This is because the model we used to fit the trait (a regression with one predictor and an intercept) is not compatible with the simple model of Brownian evolution that we assumed for the ancestral state reconstruction. As the predictor used is not known for ancestral states, it is not possible to reconstruct the trait for this particular model.</p>
<p>The only option we have is to provide the function with the predictor's ancestral states, if they are known. They are known indeed in this toy example that we generated ourselves, so we can reconstruct our trait doing the following:</p>
<div class="codehilite"><pre><span></span><span class="n">ancTrait3</span> <span class="o">=</span> <span class="n">ancestralStateReconstruction</span><span class="p">(</span><span class="n">fitTrait3</span><span class="p">,</span>
              <span class="p">[</span><span class="n">ones</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="n">sim1</span><span class="p">[</span><span class="o">:</span><span class="n">InternalNodes</span><span class="p">]</span> <span class="n">sim2</span><span class="p">[</span><span class="o">:</span><span class="n">InternalNodes</span><span class="p">]])</span>
<span class="n">plot</span><span class="p">(</span><span class="n">truenet</span><span class="p">,</span> <span class="n">nodeLabel</span> <span class="o">=</span> <span class="n">predintPlot</span><span class="p">(</span><span class="n">ancTrait3</span><span class="p">))</span>
</pre></div>


<p><img alt="" src="../../assets/figures/trait_tree_ancestral4_1.png" /></p>
<p>where we provided the ancestral predictors as a matrix, containing the intercept, and the known predictor at the nodes. The user must be very careful with this function, as no check is done for the order of the predictors, that must be in the same order as the internal nodes of the phylogeny. As ancestral predictors are often unknown, the use of this functionality is discouraged.</p>
<p><a id='Phylogenetic-ANOVA-1'></a></p>
<h2 id="phylogenetic-anova">Phylogenetic ANOVA</h2>
<p>As mentioned above, the <a href="../../lib/public/#PhyloNetworks.phyloNetworklm"><code>phyloNetworklm</code></a> function is based on the <code>lm</code> function from <a href="https://github.com/JuliaStats/GLM.jl">GLM</a>. This means that it inherits from most of its features, and in particular, it can handle formulas with factors or interactions. For example, in lizards, we might want to do a regression of toe length against body length and the region where each species is found, where this region is coded into 4 categories (say). We might also want to include an interaction effect between body length and region. (This model has no biological basis. It is just meant to show the possibilities of the function).</p>
<p>To illustrate the use of categorical predictors of particular interest in a network with reticulations, let's assume that some heterosis took place after the hybridization event, so that tips "A" and "B" have larger mean compared to the others.</p>
<div class="codehilite"><pre><span></span><span class="n">delta</span> <span class="o">=</span> <span class="mf">5.0</span><span class="p">;</span> <span class="c"># value of heterosis</span>
<span class="n">underHyb</span> <span class="o">=</span> <span class="p">[(</span><span class="n">n</span> <span class="o">==</span> <span class="s">&quot;A&quot;</span> <span class="o">||</span> <span class="n">n</span> <span class="o">==</span> <span class="s">&quot;B&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="kp">in</span> <span class="n">tipLabels</span><span class="p">(</span><span class="n">sim1</span><span class="p">)]</span> <span class="c"># tips under hybrid</span>
<span class="n">underHyb</span>
</pre></div>


<div class="codehilite"><pre><span></span>6-element Array{Bool,1}:
 false
 false
  true
  true
 false
 false
</pre></div>


<div class="codehilite"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="kp">in</span> <span class="mi">1</span><span class="o">:</span><span class="n">length</span><span class="p">(</span><span class="n">trait3</span><span class="p">)</span>
    <span class="n">underHyb</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">trait3</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+=</span><span class="n">delta</span><span class="p">)</span> <span class="c"># add delta to tips A and B</span>
<span class="k">end</span>
<span class="n">trait3</span> <span class="c"># changed: +5 was added by the previous loop to A and B</span>
</pre></div>


<div class="codehilite"><pre><span></span>6-element Array{Float64,1}:
 16.673 
 15.0831
 19.4522
 18.9712
 16.417 
 22.0269
</pre></div>


<p>The categorical variable <code>underHyb</code> separates tips "A" and "B" from the others. We need to mark it as a factor, not a numerical variable, i.e. as a <code>PooledDataArray</code>.</p>
<div class="codehilite"><pre><span></span><span class="n">dat</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">trait1</span> <span class="o">=</span> <span class="n">trait1</span><span class="p">,</span> <span class="n">trait2</span> <span class="o">=</span> <span class="n">trait2</span><span class="p">,</span> <span class="n">trait3</span> <span class="o">=</span> <span class="n">trait3</span><span class="p">,</span>
                <span class="n">underHyb</span> <span class="o">=</span> <span class="n">underHyb</span><span class="p">,</span>
                <span class="n">tipNames</span> <span class="o">=</span> <span class="n">tipLabels</span><span class="p">(</span><span class="n">sim1</span><span class="p">))</span>
<span class="n">dat</span><span class="p">[</span><span class="o">:</span><span class="n">underHyb</span><span class="p">]</span> <span class="o">=</span> <span class="n">PooledDataArray</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="o">:</span><span class="n">underHyb</span><span class="p">])</span>
</pre></div>


<p>Now we can include this factor in the regression.</p>
<div class="codehilite"><pre><span></span><span class="n">julia</span><span class="o">&gt;</span> <span class="n">fitTrait</span> <span class="o">=</span> <span class="n">phyloNetworklm</span><span class="p">(</span><span class="nd">@formula</span><span class="p">(</span><span class="n">trait3</span> <span class="o">~</span> <span class="n">trait1</span> <span class="o">+</span> <span class="n">underHyb</span><span class="p">),</span> <span class="n">dat</span><span class="p">,</span> <span class="n">truenet</span><span class="p">)</span>
<span class="n">DataFrames</span><span class="o">.</span><span class="n">DataFrameRegressionModel</span><span class="p">{</span><span class="n">PhyloNetworks</span><span class="o">.</span><span class="n">PhyloNetworkLinearModel</span><span class="p">,</span><span class="kt">Array</span><span class="p">{</span><span class="kt">Float64</span><span class="p">,</span><span class="mi">2</span><span class="p">}}</span>

<span class="n">Formula</span><span class="o">:</span> <span class="n">trait3</span> <span class="o">~</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">trait1</span> <span class="o">+</span> <span class="n">underHyb</span>

<span class="n">Model</span><span class="o">:</span> <span class="n">BM</span>

<span class="n">Parameter</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="n">Estimates</span><span class="o">:</span>
<span class="n">Sigma2</span><span class="o">:</span> <span class="mf">0.0484988</span>

<span class="n">Coefficients</span><span class="o">:</span>
                <span class="n">Estimate</span> <span class="n">Std</span><span class="o">.</span><span class="n">Error</span> <span class="n">t</span> <span class="n">value</span> <span class="n">Pr</span><span class="p">(</span><span class="o">&gt;|</span><span class="n">t</span><span class="o">|</span><span class="p">)</span>
<span class="p">(</span><span class="n">Intercept</span><span class="p">)</span>      <span class="mf">11.0616</span>   <span class="mf">1.19414</span> <span class="mf">9.26324</span>   <span class="mf">0.0027</span>
<span class="n">trait1</span>           <span class="mf">1.72504</span>  <span class="mf">0.240787</span> <span class="mf">7.16418</span>   <span class="mf">0.0056</span>
<span class="n">underHyb</span><span class="o">:</span> <span class="kc">true</span>   <span class="mf">5.07354</span>  <span class="mf">0.837326</span> <span class="mf">6.05922</span>   <span class="mf">0.0090</span>

<span class="n">Log</span> <span class="n">Likelihood</span><span class="o">:</span> <span class="o">-</span><span class="mf">3.9885372687</span>
<span class="n">AIC</span><span class="o">:</span> <span class="mf">15.9770745374</span>
</pre></div>


<p>In this case, the categorical variable indicating which tips are descendants of the reticulation event is indeed relevant, and the heterosis effect is recovered.</p>
<p>This is a very simple example of how to include heterosis, but some general functions to test for it, on networks with more than on hybrid, are also available.</p>
<p><a id='Pagel's-Lambda-1'></a></p>
<h2 id="pagels-lambda">Pagel's Lambda</h2>
<p>One classical question about trait evolution is the amount of "phylogenetic signal" in a dataset, that is, the importance of the tree structure to explain variation in the observed traits. One way of doing measuring that is to use Pagel's lambda<sup id="fnref:fn3"><a class="footnote-ref" href="#fn:fn3" rel="footnote">1</a></sup> transformation of the branch lengths. This model assumes a BM on a tree where the internal branches are multiplied by a factor λ, while the external branches are modified so that the total height of the tree is constant. Hence, λ varies between 0 (the tree has no influence on the data) and 1 (the tree is unchanged). Using the same branch length transformations, this model can be straightforwardly extended to phylogenetic networks.</p>
<p>We can illustrate this with the predictor trait we used earlier. We use the same function as before, only indicating the model we want to use:</p>
<div class="codehilite"><pre><span></span><span class="n">fitPagel</span> <span class="o">=</span> <span class="n">phyloNetworklm</span><span class="p">(</span><span class="nd">@formula</span><span class="p">(</span><span class="n">trait1</span> <span class="o">~</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dat</span><span class="p">,</span> <span class="n">truenet</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s">&quot;lambda&quot;</span><span class="p">)</span>
</pre></div>


<p>As it is indeed generated according to a plain BM on the phylogeny, the estimated λ should be close to 1. It can be extracted with function <code>lambda_estim</code>:</p>
<div class="codehilite"><pre><span></span><span class="n">julia</span><span class="o">&gt;</span> <span class="n">lambda_estim</span><span class="p">(</span><span class="n">fitPagel</span><span class="p">)</span>
<span class="mf">0.9073561228997261</span>
</pre></div>


<div class="footnote">
<hr />
<ol>
<li id="fn:fn3">
<p>Pagel M (1999). Inferring the historical patterns of biological     evolution. Nature. 401: 877–884. doi:10.1038/44766&#160;<a class="footnote-backref" href="#fnref:fn3" rev="footnote" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
</ol>
</div>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../multiplealleles/" title="Multiple Alleles" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Multiple Alleles
              </span>
            </div>
          </a>
        
        
          <a href="../../lib/public/" title="Public" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Public
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application-c35428f87f.js"></script>
      
      
      <script>app.initialize({url:{base:"../.."}})</script>
      
        <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      
        <script src="../../assets/mathjaxhelper.js"></script>
      
    
    
      
    
  </body>
</html>